{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/ashutosh/Attack%20Capital/assignment/frontend/app/api/connection-details/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { AccessToken, type AccessTokenOptions, type VideoGrant } from 'livekit-server-sdk';\nimport { RoomConfiguration } from '@livekit/protocol';\n\n// Environment variables\nconst API_KEY = process.env.LIVEKIT_API_KEY;\nconst API_SECRET = process.env.LIVEKIT_API_SECRET;\nconst LIVEKIT_URL = process.env.LIVEKIT_URL;\n\nexport const revalidate = 0;\n\nexport type ConnectionDetails = {\n  serverUrl: string;\n  roomName: string;\n  participantName: string;\n  participantToken: string;\n};\n\nexport async function POST(req: Request) {\n  try {\n    if (LIVEKIT_URL === undefined) {\n      throw new Error('LIVEKIT_URL is not defined');\n    }\n    if (API_KEY === undefined) {\n      throw new Error('LIVEKIT_API_KEY is not defined');\n    }\n    if (API_SECRET === undefined) {\n      throw new Error('LIVEKIT_API_SECRET is not defined');\n    }\n\n    // Parse agent configuration from request body\n    const body = await req.json();\n    const agentName: string = body?.room_config?.agents?.[0]?.agent_name;\n\n    // Generate participant token\n    const participantName = 'user';\n    const participantIdentity = `voice_assistant_user_${Math.floor(Math.random() * 10_000)}`;\n    const roomName = `voice_assistant_room_${Math.floor(Math.random() * 10_000)}`;\n\n    const participantToken = await createParticipantToken(\n      { identity: participantIdentity, name: participantName },\n      roomName,\n      agentName\n    );\n\n    // Return connection details\n    const data: ConnectionDetails = {\n      serverUrl: LIVEKIT_URL,\n      roomName,\n      participantToken: participantToken,\n      participantName,\n    };\n\n    const headers = new Headers({\n      'Cache-Control': 'no-store',\n    });\n    return NextResponse.json(data, { headers });\n  } catch (error) {\n    if (error instanceof Error) {\n      console.error(error);\n      return new NextResponse(error.message, { status: 500 });\n    }\n  }\n}\n\nfunction createParticipantToken(\n  userInfo: AccessTokenOptions,\n  roomName: string,\n  agentName?: string\n): Promise<string> {\n  const at = new AccessToken(API_KEY, API_SECRET, {\n    ...userInfo,\n    ttl: '15m',\n  });\n  const grant: VideoGrant = {\n    room: roomName,\n    roomJoin: true,\n    canPublish: true,\n    canPublishData: true,\n    canSubscribe: true,\n  };\n  at.addGrant(grant);\n\n  if (agentName) {\n    at.roomConfig = new RoomConfiguration({\n      agents: [{ agentName }],\n    });\n  }\n\n  return at.toJwt();\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;AACA;;;;AAEA,wBAAwB;AACxB,MAAM,UAAU,QAAQ,GAAG,CAAC,eAAe;AAC3C,MAAM,aAAa,QAAQ,GAAG,CAAC,kBAAkB;AACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAEpC,MAAM,aAAa;AASnB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,IAAI,gBAAgB,WAAW;YAC7B,MAAM,IAAI,MAAM;QAClB;QACA,IAAI,YAAY,WAAW;YACzB,MAAM,IAAI,MAAM;QAClB;QACA,IAAI,eAAe,WAAW;YAC5B,MAAM,IAAI,MAAM;QAClB;QAEA,8CAA8C;QAC9C,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,YAAoB,MAAM,aAAa,QAAQ,CAAC,EAAE,EAAE;QAE1D,6BAA6B;QAC7B,MAAM,kBAAkB;QACxB,MAAM,sBAAsB,CAAC,qBAAqB,EAAE,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,SAAS;QACxF,MAAM,WAAW,CAAC,qBAAqB,EAAE,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,SAAS;QAE7E,MAAM,mBAAmB,MAAM,uBAC7B;YAAE,UAAU;YAAqB,MAAM;QAAgB,GACvD,UACA;QAGF,4BAA4B;QAC5B,MAAM,OAA0B;YAC9B,WAAW;YACX;YACA,kBAAkB;YAClB;QACF;QAEA,MAAM,UAAU,IAAI,QAAQ;YAC1B,iBAAiB;QACnB;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;YAAE;QAAQ;IAC3C,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,OAAO;YAC1B,QAAQ,KAAK,CAAC;YACd,OAAO,IAAI,gJAAY,CAAC,MAAM,OAAO,EAAE;gBAAE,QAAQ;YAAI;QACvD;IACF;AACF;AAEA,SAAS,uBACP,QAA4B,EAC5B,QAAgB,EAChB,SAAkB;IAElB,MAAM,KAAK,IAAI,gLAAW,CAAC,SAAS,YAAY;QAC9C,GAAG,QAAQ;QACX,KAAK;IACP;IACA,MAAM,QAAoB;QACxB,MAAM;QACN,UAAU;QACV,YAAY;QACZ,gBAAgB;QAChB,cAAc;IAChB;IACA,GAAG,QAAQ,CAAC;IAEZ,IAAI,WAAW;QACb,GAAG,UAAU,GAAG,IAAI,8LAAiB,CAAC;YACpC,QAAQ;gBAAC;oBAAE;gBAAU;aAAE;QACzB;IACF;IAEA,OAAO,GAAG,KAAK;AACjB","debugId":null}}]
}