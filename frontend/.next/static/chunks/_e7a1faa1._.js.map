{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ashutosh/Attack%20Capital/assignment/frontend/hooks/useConnectionDetails.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport { decodeJwt } from 'jose';\nimport { ConnectionDetails } from '@/app/api/connection-details/route';\nimport { AppConfig } from '@/lib/types';\n\nconst ONE_MINUTE_IN_MILLISECONDS = 60 * 1000;\n\nexport default function useConnectionDetails(appConfig: AppConfig) {\n  // Generate room connection details, including:\n  //   - A random Room name\n  //   - A random Participant name\n  //   - An Access Token to permit the participant to join the room\n  //   - The URL of the LiveKit server to connect to\n  //\n  // In real-world application, you would likely allow the user to specify their\n  // own participant name, and possibly to choose from existing rooms to join.\n\n  const [connectionDetails, setConnectionDetails] = useState<ConnectionDetails | null>(null);\n\n  const fetchConnectionDetails = useCallback(async () => {\n    setConnectionDetails(null);\n    const url = new URL(\n      process.env.NEXT_PUBLIC_CONN_DETAILS_ENDPOINT ?? '/api/connection-details',\n      window.location.origin\n    );\n\n    let data: ConnectionDetails;\n    try {\n      const res = await fetch(url.toString(), {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Sandbox-Id': appConfig.sandboxId ?? '',\n        },\n        body: JSON.stringify({\n          room_config: appConfig.agentName\n            ? {\n                agents: [{ agent_name: appConfig.agentName }],\n              }\n            : undefined,\n        }),\n      });\n      data = await res.json();\n    } catch (error) {\n      console.error('Error fetching connection details:', error);\n      throw new Error('Error fetching connection details!');\n    }\n\n    setConnectionDetails(data);\n    return data;\n  }, []);\n\n  useEffect(() => {\n    fetchConnectionDetails();\n  }, [fetchConnectionDetails]);\n\n  const isConnectionDetailsExpired = useCallback(() => {\n    const token = connectionDetails?.participantToken;\n    if (!token) {\n      return true;\n    }\n\n    const jwtPayload = decodeJwt(token);\n    if (!jwtPayload.exp) {\n      return true;\n    }\n    const expiresAt = new Date(jwtPayload.exp * 1000 - ONE_MINUTE_IN_MILLISECONDS);\n\n    const now = new Date();\n    return expiresAt <= now;\n  }, [connectionDetails?.participantToken]);\n\n  const existingOrRefreshConnectionDetails = useCallback(async () => {\n    if (isConnectionDetailsExpired() || !connectionDetails) {\n      return fetchConnectionDetails();\n    } else {\n      return connectionDetails;\n    }\n  }, [connectionDetails, fetchConnectionDetails, isConnectionDetailsExpired]);\n\n  return {\n    connectionDetails,\n    refreshConnectionDetails: fetchConnectionDetails,\n    existingOrRefreshConnectionDetails,\n  };\n}\n"],"names":[],"mappings":";;;;AAsBM;AAtBN;AACA;;;;AAIA,MAAM,6BAA6B,KAAK;AAEzB,SAAS,qBAAqB,SAAoB;;IAC/D,+CAA+C;IAC/C,yBAAyB;IACzB,gCAAgC;IAChC,iEAAiE;IACjE,kDAAkD;IAClD,EAAE;IACF,8EAA8E;IAC9E,4EAA4E;IAE5E,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,yKAAQ,EAA2B;IAErF,MAAM,yBAAyB,IAAA,4KAAW;oEAAC;YACzC,qBAAqB;gBAEnB;YADF,MAAM,MAAM,IAAI,IACd,CAAA,iDAAA,2KAAO,CAAC,GAAG,CAAC,iCAAiC,cAA7C,4DAAA,iDAAiD,2BACjD,OAAO,QAAQ,CAAC,MAAM;YAGxB,IAAI;YACJ,IAAI;oBAKkB;gBAJpB,MAAM,MAAM,MAAM,MAAM,IAAI,QAAQ,IAAI;oBACtC,QAAQ;oBACR,SAAS;wBACP,gBAAgB;wBAChB,gBAAgB,CAAA,uBAAA,UAAU,SAAS,cAAnB,kCAAA,uBAAuB;oBACzC;oBACA,MAAM,KAAK,SAAS,CAAC;wBACnB,aAAa,UAAU,SAAS,GAC5B;4BACE,QAAQ;gCAAC;oCAAE,YAAY,UAAU,SAAS;gCAAC;6BAAE;wBAC/C,IACA;oBACN;gBACF;gBACA,OAAO,MAAM,IAAI,IAAI;YACvB,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,sCAAsC;gBACpD,MAAM,IAAI,MAAM;YAClB;YAEA,qBAAqB;YACrB,OAAO;QACT;mEAAG,EAAE;IAEL,IAAA,0KAAS;0CAAC;YACR;QACF;yCAAG;QAAC;KAAuB;IAE3B,MAAM,6BAA6B,IAAA,4KAAW;wEAAC;YAC7C,MAAM,QAAQ,8BAAA,wCAAA,kBAAmB,gBAAgB;YACjD,IAAI,CAAC,OAAO;gBACV,OAAO;YACT;YAEA,MAAM,aAAa,IAAA,6KAAS,EAAC;YAC7B,IAAI,CAAC,WAAW,GAAG,EAAE;gBACnB,OAAO;YACT;YACA,MAAM,YAAY,IAAI,KAAK,WAAW,GAAG,GAAG,OAAO;YAEnD,MAAM,MAAM,IAAI;YAChB,OAAO,aAAa;QACtB;uEAAG;QAAC,8BAAA,wCAAA,kBAAmB,gBAAgB;KAAC;IAExC,MAAM,qCAAqC,IAAA,4KAAW;gFAAC;YACrD,IAAI,gCAAgC,CAAC,mBAAmB;gBACtD,OAAO;YACT,OAAO;gBACL,OAAO;YACT;QACF;+EAAG;QAAC;QAAmB;QAAwB;KAA2B;IAE1E,OAAO;QACL;QACA,0BAA0B;QAC1B;IACF;AACF;GA9EwB","debugId":null}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///Users/ashutosh/Attack%20Capital/assignment/frontend/components/app.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useMemo, useState } from 'react';\nimport { Room, RoomEvent } from 'livekit-client';\nimport { motion } from 'motion/react';\nimport { RoomAudioRenderer, RoomContext, StartAudio } from '@livekit/components-react';\nimport { toastAlert } from '@/components/alert-toast';\nimport { SessionView } from '@/components/session-view';\nimport { Toaster } from '@/components/ui/sonner';\nimport { Welcome } from '@/components/welcome';\nimport useConnectionDetails from '@/hooks/useConnectionDetails';\nimport type { AppConfig } from '@/lib/types';\n\nconst MotionWelcome = motion.create(Welcome);\nconst MotionSessionView = motion.create(SessionView);\n\ninterface AppProps {\n  appConfig: AppConfig;\n}\n\nexport function App({ appConfig }: AppProps) {\n  const room = useMemo(() => new Room(), []);\n  const [sessionStarted, setSessionStarted] = useState(false);\n  const { refreshConnectionDetails, existingOrRefreshConnectionDetails } =\n    useConnectionDetails(appConfig);\n\n  useEffect(() => {\n    const onDisconnected = () => {\n      setSessionStarted(false);\n      refreshConnectionDetails();\n    };\n    const onMediaDevicesError = (error: Error) => {\n      toastAlert({\n        title: 'Encountered an error with your media devices',\n        description: `${error.name}: ${error.message}`,\n      });\n    };\n    room.on(RoomEvent.MediaDevicesError, onMediaDevicesError);\n    room.on(RoomEvent.Disconnected, onDisconnected);\n    return () => {\n      room.off(RoomEvent.Disconnected, onDisconnected);\n      room.off(RoomEvent.MediaDevicesError, onMediaDevicesError);\n    };\n  }, [room, refreshConnectionDetails]);\n\n  useEffect(() => {\n    let aborted = false;\n    if (sessionStarted && room.state === 'disconnected') {\n      Promise.all([\n        room.localParticipant.setMicrophoneEnabled(true, undefined, {\n          preConnectBuffer: appConfig.isPreConnectBufferEnabled,\n        }),\n        existingOrRefreshConnectionDetails().then((connectionDetails) =>\n          room.connect(connectionDetails.serverUrl, connectionDetails.participantToken)\n        ),\n      ]).catch((error) => {\n        if (aborted) {\n          // Once the effect has cleaned up after itself, drop any errors\n          //\n          // These errors are likely caused by this effect rerunning rapidly,\n          // resulting in a previous run `disconnect` running in parallel with\n          // a current run `connect`\n          return;\n        }\n\n        toastAlert({\n          title: 'There was an error connecting to the agent',\n          description: `${error.name}: ${error.message}`,\n        });\n      });\n    }\n    return () => {\n      aborted = true;\n      room.disconnect();\n    };\n  }, [room, sessionStarted, appConfig.isPreConnectBufferEnabled]);\n\n  const { startButtonText } = appConfig;\n\n  return (\n    <main>\n      <MotionWelcome\n        key=\"welcome\"\n        startButtonText={startButtonText}\n        onStartCall={() => setSessionStarted(true)}\n        disabled={sessionStarted}\n        initial={{ opacity: 1 }}\n        animate={{ opacity: sessionStarted ? 0 : 1 }}\n        transition={{ duration: 0.5, ease: 'linear', delay: sessionStarted ? 0 : 0.5 }}\n      />\n\n      <RoomContext.Provider value={room}>\n        <RoomAudioRenderer />\n        <StartAudio label=\"Start Audio\" />\n        {/* --- */}\n        <MotionSessionView\n          key=\"session-view\"\n          appConfig={appConfig}\n          disabled={!sessionStarted}\n          sessionStarted={sessionStarted}\n          initial={{ opacity: 0 }}\n          animate={{ opacity: sessionStarted ? 1 : 0 }}\n          transition={{\n            duration: 0.5,\n            ease: 'linear',\n            delay: sessionStarted ? 0.5 : 0,\n          }}\n        />\n      </RoomContext.Provider>\n\n      <Toaster />\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;;AAEA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;AAKA;;;AAVA;;;;;;;;;;AAaA,MAAM,gBAAgB,OAAO,MAAM,CAAC;KAA9B;AACN,MAAM,oBAAoB,OAAO,MAAM,CAAC;MAAlC;AAMC,SAAS,IAAI,KAAuB;QAAvB,EAAE,SAAS,EAAY,GAAvB;;IAClB,MAAM,OAAO,IAAA,wKAAO;6BAAC,IAAM,IAAI,iLAAI;4BAAI,EAAE;IACzC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IACrD,MAAM,EAAE,wBAAwB,EAAE,kCAAkC,EAAE,GACpE,IAAA,2IAAoB,EAAC;IAEvB,IAAA,0KAAS;yBAAC;YACR,MAAM;gDAAiB;oBACrB,kBAAkB;oBAClB;gBACF;;YACA,MAAM;qDAAsB,CAAC;oBAC3B,WAAW;wBACT,OAAO;wBACP,aAAa,AAAC,GAAiB,OAAf,MAAM,IAAI,EAAC,MAAkB,OAAd,MAAM,OAAO;oBAC9C;gBACF;;YACA,KAAK,EAAE,CAAC,sLAAS,CAAC,iBAAiB,EAAE;YACrC,KAAK,EAAE,CAAC,sLAAS,CAAC,YAAY,EAAE;YAChC;iCAAO;oBACL,KAAK,GAAG,CAAC,sLAAS,CAAC,YAAY,EAAE;oBACjC,KAAK,GAAG,CAAC,sLAAS,CAAC,iBAAiB,EAAE;gBACxC;;QACF;wBAAG;QAAC;QAAM;KAAyB;IAEnC,IAAA,0KAAS;yBAAC;YACR,IAAI,UAAU;YACd,IAAI,kBAAkB,KAAK,KAAK,KAAK,gBAAgB;gBACnD,QAAQ,GAAG,CAAC;oBACV,KAAK,gBAAgB,CAAC,oBAAoB,CAAC,MAAM,WAAW;wBAC1D,kBAAkB,UAAU,yBAAyB;oBACvD;oBACA,qCAAqC,IAAI;yCAAC,CAAC,oBACzC,KAAK,OAAO,CAAC,kBAAkB,SAAS,EAAE,kBAAkB,gBAAgB;;iBAE/E,EAAE,KAAK;qCAAC,CAAC;wBACR,IAAI,SAAS;4BACX,+DAA+D;4BAC/D,EAAE;4BACF,mEAAmE;4BACnE,oEAAoE;4BACpE,0BAA0B;4BAC1B;wBACF;wBAEA,WAAW;4BACT,OAAO;4BACP,aAAa,AAAC,GAAiB,OAAf,MAAM,IAAI,EAAC,MAAkB,OAAd,MAAM,OAAO;wBAC9C;oBACF;;YACF;YACA;iCAAO;oBACL,UAAU;oBACV,KAAK,UAAU;gBACjB;;QACF;wBAAG;QAAC;QAAM;QAAgB,UAAU,yBAAyB;KAAC;IAE9D,MAAM,EAAE,eAAe,EAAE,GAAG;IAE5B,qBACE,6LAAC;;0BACC,6LAAC;gBAEC,iBAAiB;gBACjB,aAAa,IAAM,kBAAkB;gBACrC,UAAU;gBACV,SAAS;oBAAE,SAAS;gBAAE;gBACtB,SAAS;oBAAE,SAAS,iBAAiB,IAAI;gBAAE;gBAC3C,YAAY;oBAAE,UAAU;oBAAK,MAAM;oBAAU,OAAO,iBAAiB,IAAI;gBAAI;eANzE;;;;;0BASN,6LAAC,uOAAW,CAAC,QAAQ;gBAAC,OAAO;;kCAC3B,6LAAC,qPAAiB;;;;;kCAClB,6LAAC,uOAAU;wBAAC,OAAM;;;;;;kCAElB,6LAAC;wBAEC,WAAW;wBACX,UAAU,CAAC;wBACX,gBAAgB;wBAChB,SAAS;4BAAE,SAAS;wBAAE;wBACtB,SAAS;4BAAE,SAAS,iBAAiB,IAAI;wBAAE;wBAC3C,YAAY;4BACV,UAAU;4BACV,MAAM;4BACN,OAAO,iBAAiB,MAAM;wBAChC;uBAVI;;;;;;;;;;;0BAcR,6LAAC;;;;;;;;;;;AAGP;GA7FgB;;QAIZ,2IAAoB;;;MAJR","debugId":null}}]
}